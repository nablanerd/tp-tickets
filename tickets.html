<!DOCTYPE html>
<html>
  <head>
    <title>Parcel Sandbox</title>
    <meta charset="UTF-8" />

<style>

.container {

    display: flex;
    justify-content: space-evenly;
}

</style></head>

  <body>
    <h1>Tickets App</h1>
    <form id="form">
      <label for="todo">Ticket:</label>
      <input
        type="text"
        name="ticket"
        placeholder="Add a ticket"
        id="ticketInput"
        value=""
      />

      <input type="submit" value="Add a ticket" />
    </form>
   <!-- <ul id="todolist"></ul> -->

    <div class="container">


        <div id="newTickets">
<h2>Nouveau</h2>
        </div>

        <div id="inProgressTickets">
            <h2>En cours</h2>


        </div>

        <div id="DoneTickets">
            <h2>Termin√©</h2>


        </div>

    </div>

<script>

const form = document.getElementById("form");
const ticketInput = document.getElementById("ticketInput");

const newTicketsTarget = document.getElementById("newTickets");
const inProgressTicketsTarget = document.getElementById("inProgressTickets");
const DoneTicketsTarget = document.getElementById("DoneTickets");

const createNewTicket = ( value) => {
const newTicket = document.createElement("div");
newTicket.innerText = value;
newTicket.id = value;

return newTicket
}

const targetAutomata = [
 
  {name : "inprogress",
  nextTag : "done",
  nextNode : inProgressTicketsTarget

  },

  {name : "done",
  nextTag : null,
  nextNode : DoneTicketsTarget

  }

]

/* {id:"",
currentState:0
} */

let i = 0
let ticketList =[
]
form.onsubmit = function (event) {
  event.preventDefault();

//console.log(targetAutomata[currentState])

//const targetNode = targetAutomata[currentState]
//const key = targetNode.name

//targetNode.next.appendChild(updateTicket(key, ticketInput.value, null))

//let currentState = 0
//currentState++

  //inProgressTicketsTarget.appendChild()
  //DoneTicketsTarget.appendChild())

 //0 => newTicketsTarget => inProgressTicketsTarget => DoneTicketsTarget
 //DoneTicketsTarget => inProgressTicketsTarget

let magicTicket = createNewTicket(ticketInput.value)

newId = i++
ticketList.push({
id : newId,
ticketNode : magicTicket,
state : 0
})

//magicTicket = updateTicket(magicTicket, "inprogress", moveTicket(magicTicket,inProgressTicketsTarget, newId ))
magicTicket = updateTicketV2(magicTicket, newId)




newTicketsTarget.appendChild(magicTicket)

}

const updateTicketV2 = (ticket, id) => {



const newButton = document.createElement("button");
newButton.innerText = "inprogress"
newButton.id = `button-${id}`

newButton.addEventListener("click", ()=>{ 

  if(targetAutomata[ticketList[id].state].nextTag === null) 
  {
    document.getElementById(`button-${id}`).remove()
    //return
  }

  newButton.innerText = targetAutomata[ticketList[id].state].nextTag

  targetAutomata[ticketList[id].state].nextNode.appendChild(ticket)

  ticketList[id].state++

})

ticket.appendChild(newButton)


return ticket
}
/* 
const moveTicket = (ticket, nextTarget, id, currentButton=null) => {

    console.log("moveTicket");

  return function ()
  {

    let currentState = ticketList[id].state++

    console.log(targetAutomata[currentState] )
    
  ticket.remove()

  if(currentButton !==null )
  currentButton.remove()

  nextTarget.appendChild(ticket)
    
  }


} */
/* 
const updateTicket = (ticket, nextKey, buttonCallBack) => {

  const newButton = generateButton(nextKey, buttonCallBack)
      ticket.appendChild(newButton)

      return ticket
}


const generateButton = (contentText, callBack) =>{

const newButton = document.createElement("button");
newButton.innerText = contentText;

newButton.addEventListener("click", callBack)

return newButton
} */

//ticket.appendChild(button)



</script>

</body>
</html>
